var fs, path, git, create, ensure_subrepo_exists;
'use strict';
fs = require('fs-extra');
path = require('path');
git = require('simple-git');
create = function create(root, parent_path, project_name, cb) {
  var err, subrepo_path;
  fs.remove(path.resolve(parent_path, project_name), function (arguments, _$param0) {
    err = _$param0;
    if (err) {
      return cb(err);
    }
    fs.copy(path.resolve(root, 'src', 'create', 'skeleton'), path.resolve(parent_path, project_name), function (arguments, _$param1) {
      err = _$param1;
      if (err) {
        return cb(err);
      }
      subrepo_path = path.resolve(root, 'subrepo_for_updatables');
      ensure_subrepo_exists(subrepo_path, function (arguments, _$param2) {
        err = _$param2;
        if (err) {
          return cb(err);
        }
        git(subrepo_path).checkout('master', function (arguments, _$param3) {
          err = _$param3;
          if (err) {
            return cb(err);
          }
          fs.copy(path.resolve(subrepo_path, 'gen', 'release', 'updatables'), path.resolve(parent_path, project_name, 'gen', '.updatables'), function (arguments, _$param4) {
            err = _$param4;
            if (err) {
              return cb(err);
            }
            cb(null);
          }.bind(this, arguments));
        }.bind(this, arguments));
      }.bind(this, arguments));
    }.bind(this, arguments));
  }.bind(this, arguments));
};
ensure_subrepo_exists = function ensure_subrepo_exists(subrepo_path, cb) {
  var subrepo_exists;
  fs.exists(subrepo_path, function (arguments, _$param5) {
    subrepo_exists = _$param5;
    if (subrepo_exists) {
      return cb(null);
    }
    git('.').clone('git@github.com:Cogmob/lambda_pattern_es6.git', subrepo_path, cb);
  }.bind(this, arguments));
};
module.exports = create;
/* Generated by Continuation.js v0.1.7 */